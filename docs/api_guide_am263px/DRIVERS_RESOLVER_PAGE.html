<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263Px MCU+ SDK: RESOLVER</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263Px MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263Px MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('DRIVERS_RESOLVER_PAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">RESOLVER </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1027">Features Supported</a></li>
<li class="level1"><a href="#autotoc_md1028">SysConfig Features</a></li>
<li class="level1"><a href="#autotoc_md1029">Features NOT Supported</a></li>
<li class="level1"><a href="#autotoc_md1030">Important Usage Guidelines</a></li>
<li class="level1"><a href="#autotoc_md1031">Software Programming Guide</a></li>
<li class="level1"><a href="#autotoc_md1032">Tuning Parameters</a></li>
<li class="level1"><a href="#autotoc_md1033">Example Usage</a></li>
<li class="level1"><a href="#autotoc_md1034">API</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_drivers_resolver"></a></p>
<p>The Resolver driver provides API to configure the Resolver to Digital Converter module. Below are the high level features supported by the Resolver driver.</p>
<h1><a class="anchor" id="autotoc_md1027"></a>
Features Supported</h1>
<ul>
<li>Excitation Signal configurations<ul>
<li>Frequency of 5KHz, 10KHz, 20KHz</li>
<li>Amplitude</li>
<li>Phase</li>
</ul>
</li>
<li>Single and Differential Ended sampling from the Sin, Cos Channels from the ADC_Rx Channels (x = 0,1)</li>
<li>Different Sequencer modes to collect samples on sin, cos channels from ADC_Rx Channels (x= 0,1)</li>
<li>Burst modes of sample collection to be averaged for sequencer mode 0.</li>
<li>Sync In signal from the Motor control PWM via PWM Xbar</li>
<li>Sample Signal to SOC start delay</li>
<li>2 Resolver Core configurations<ul>
<li>DC offset Auto Estimation and Manual Correction, Band Pass Filter for the input samples.</li>
<li>Phase Gain Auto Estimation and Auto/ Manual Correction on Sin, Cos samples</li>
<li>16 bit singed angle outputs from Arctan and Track2 loops</li>
<li>32 bit singed velocity outputs from Track2 loop.</li>
<li>Error flags on multiple safety / redundancy signals.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1028"></a>
SysConfig Features</h1>
<dl class="section note"><dt>Note</dt><dd>It is strongly recommend to use SysConfig where it is available instead of using direct SW API calls. This will help simplify the SW application and also catch common mistakes early in the development cycle.</dd></dl>
<ul>
<li>Input configurations<ul>
<li>Signal mode</li>
<li>ADC SoC width</li>
<li>ADC Burst Count</li>
<li>Sequencer Mode configurations</li>
</ul>
</li>
<li>Excitation frequency Configurations<ul>
<li>Frequncy, Amplitude and Phase</li>
<li>Sync In enable/disable</li>
<li>ADC SOC delay</li>
</ul>
</li>
<li>Tuning Parameters</li>
<li>Each Resolver Core Configurations<ul>
<li>DC offset / BPF enable</li>
<li>Ideal Sample configurations</li>
<li>Phase Gain correction block configurations</li>
<li>Track2 configurations</li>
</ul>
</li>
<li>Interrupt Configurations</li>
</ul>
<h1><a class="anchor" id="autotoc_md1029"></a>
Features NOT Supported</h1>
<ul>
<li>Tuning Parameters from the external memory are not supported yet.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1030"></a>
Important Usage Guidelines</h1>
<ul>
<li>Resolver should be disabled while configuring the blocks. Post the configurations, the Resolver may be enabled.</li>
<li>DC offset Correction is either from manual offset value or from the estimation loop. when BPF is enabled and DC offset correction (auto) is disabled, it is recommended to turn manual DC offset values to 0. Otherwise, the Signals post BPF will still be added with the manual DC offset values and this can lead to the unexpected / saturated results.</li>
<li>Auto Ideal Sample detection, if ran, should be performed with DC offset correction off. once the Ideal sample is observed, then the DC offset correction may be turned on.</li>
<li>In order to use the Phase Gain Estimation loops, the motor should be in rotation.</li>
<li>Angle from ArcTan and Track2 loops is a signed 16 bit integer, mapping values in -180 degrees to 180 degrees.</li>
<li>Velocity from the Track2 loop is a signed 32 bit integer, and can be considered angle change from the sampling rate of the Track2 loop, which is either the exictation frequency, if the bottom sampling is turned off, or twice the excitation frequency, if the bottom sampling is turned on.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1031"></a>
Software Programming Guide</h1>
<p>The Resolver driver contains flat APIs for individual register configurations and a top level init function, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gadd8fc034979961c35472233f5c7e4f0b" title="Configures the RDC based on the parameter values.">RDC_init()</a></code> to be used with a <code><a class="el" href="structRDC__configParams.html" title="Struct holds the RDC configurations Can be passed to RDC_paramsInit(RDC_configParams* params); RDC_in...">RDC_configParams</a></code> params.</p>
<ol type="1">
<li>Before using the RDC, please ensure the configurations are valid and the important guidelines are followed.</li>
<li>Disable the Resolver before configurations, with <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gadb9920752beef0b50c0ca96062560124" title="Disables the Resolver Operation.">RDC_disableResolver()</a></code>. The resolver may be enabled post the configurations using the API, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gaa8b76189075c93434e05e8fa6d6101ea" title="Enables the Resolver Operation.">RDC_enableResolver()</a></code></li>
<li>Baseline Parameters are to be initiated using the API, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gabd4136d081088f58c8c22e92c2de303f" title="Inits Baseline Parameter configurations.">RDC_BaselineParametersInit()</a></code>, for the resolver to operated properly.</li>
<li>Configure the Global configurations, like the ADC mode of sampling, ADC soc width, Burst count, sequencer operational mode using the following APIs.<ol type="a">
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gaef5c22f62c139bfe504c43ebfe87b31d" title="Enable Single Ended Mode of operation.">RDC_enableAdcSingleEndedMode()</a></code>,<code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gabb3c2fb7c97ee3e28b93216c9cf697b9" title="Disable Single Ended Mode of operation.">RDC_disableAdcSingleEndedMode()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gabedb82aa05b24c1413a7472ded89d746" title="sets the Start of Conversion Width for the ADC conversion">RDC_setAdcSocWidth()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga67531aa994929388ec445174bc81e83a" title="sets Sequencer Operational Mode Valid values are RDC_SEQUENCER_MODE_0 - ADC0 SAMPLES SIN AND ADC1 SAM...">RDC_setAdcSequencerOperationalMode()</a></code></li>
</ol>
</li>
<li>Following, The Excitation Frequency and the Sampling Configurations may be set appropriately using the following APIs<ol type="a">
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga214dd921ae267c6733f9c576e15aa229" title="Sets the Excitation frequency value from the selected values.">RDC_setExcitationSignalFrequencySelect()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga09ac9ae7fa5c1008c8caa1391c66a2f0" title="Sets the Phase value for the Excitation Signal. Phase values in the range [RDC_EXCITATION_FREQUENCY_M...">RDC_setExcitationSignalPhase()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga83022cb07032ef18436163e7d1d13df1" title="set the Amplitude control for the excitation signal">RDC_setExcitationSignalAmplitudeControl()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga368c6bb1a3d4391036f526336fb80ecf" title="Enables the Excitation Signal Sync In.">RDC_enableExcitationSignalSyncIn()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga33429273c33a5d891f1b35b3567d9b49" title="Disables the Excitation Signal Sync In.">RDC_disableExcitationSignalSyncIn()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gadb3967dc11c335aec4b322dac9c9a15f" title="Sets the SOC Delay from the PWM Exciation Signal.">RDC_setExcitationSignalSocDelay()</a></code></li>
</ol>
</li>
<li>Now configure the each resolver core based on the configured sequencer mode.</li>
<li>Configure the Manual DC Offset values to 0 and disable the auto DC offset correction, if DC offset correction has to be disabled. Otherwise, configure the appropriate Offset Calibration Coefficients, Auto Correction enable/disable and Manual correction values via the following API for each core. It is recommended to find the estimated values and replace them into the Manual values and keep the estimation logic for redundancy check.<ol type="a">
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gabcb0aeaa1aa4e82ec4b32859d68c4963" title="Sets the DC Offset Coefficients coef1, coef2.">RDC_setDcOffsetCalCoef()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga4154599b3163fc0dc9ada388f846a670" title="Disbales Auto Offset correction from the estimated values Enables DC Offset Manual Correction logic.">RDC_disableDcOffsetAutoCorrection()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga2cbde9294bf8c1afc4684032da0cdaba" title="Enables Auto DC Offset Correction from the estimated values Disables DC Offset Manual Correction logi...">RDC_enableDcOffsetAutoCorrection()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga586af95565fc0e09c97b99c9842afae7" title="Sets the Sin, Cosine Manual Correction values for the Dc Offset block in the given resolver core.">RDC_setDcOffsetManualCorrectionValue()</a></code></li>
</ol>
</li>
<li>BPF filter can be used for the excitation frequency of 20KHz. If BPF is used, it is recommended to disable the DC offset Correction, as this removes the offsets. The BPF may be enabled/ disabled by the following APIs<ol type="a">
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga5ee348870ec500a97fe86a5408275f8c" title="enables Band Pass Filter before DC Offset logic.">RDC_enableBPF()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga8253b1ab10d7dd9ea9212debb33d109a" title="Disables Band Pass Filter Logic before DC Offset logic.">RDC_disableBPF()</a></code></li>
</ol>
</li>
<li>The Ideal Sample Time may be overriden with the Manual Value and the Ideal Sample Mode should be set to Manual. If Manual value is unknown, it is recommended to use the Auto Modes (Modes 0 through 2) for auto Ideal Sample Mode of operation. The following APIs may be used for the Ideal Sample Configurations. Please Note that the bottom sampling may be used, but the computations now run twice the excitation frequency rate.<ol type="a">
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gaa5be4cbb1ac38bfc9b3882d4a9e7c5cb" title="Ideal Sample Time Computation Mode selection.">RDC_setIdealSampleMode()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gaaf6c505d9f6d67e15adef7e1e7568b1b" title="sets the Override value for the Ideal Sample Time selection.">RDC_overrideIdealSampleTime()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga983aca05fd741d444e710982e73a9a00" title="sets Ideal Sample Detetction Threshold. validates the sample for the Ideal Sample time detection comp...">RDC_setIdealSampleDetectionThreshold()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga5c9637ce8ff566a54ea37f394be924e7" title="the BPF sample adjust when the BPF is turned on. This configuration takes effect only on the auto mod...">RDC_setIdealSampleBpfAdjust()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga6d9ed18f76a5cfec97ad5dc3d233bb5d" title="Enables bottom Sampling. twice the sampling rate than disabled. the track2 loop runs twice the speed ...">RDC_enableIdealSampleBottomSampling()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga859668a2dcf28a3b1e252e469fbb837b" title="Disables Bottom Sampling.">RDC_disableIdealSampleBottomSampling()</a></code></li>
</ol>
</li>
<li>Phase Gain Estimation/ auto correction logic needs the Motor to be rotating. Otherwise, the Manual values may be used for Sine, Cosine Gain Values and the Cosine Phase value. the following APIs may be used for the Phase Gain correction logic. It is recommended to find the estimated values and replace them into the Manual values and keep the estimation logic for redundancy check.<ol type="a">
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga6fb7d9888b74ec0a5a0850d5dd08dee6" title="Sets the Phase Gain Estimation train limit. if the programmed value is x, 2^x rotations are considere...">RDC_setPhaseGainEstimationTrainLimit()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga535b694a20c13341af724c5709921ff6" title="Enables Phase Gain Estimation in the background.">RDC_enablePhaseGainEstimation()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga42086b069f7b041c87dcdada53f77afb" title="Disbales Phase Gain Estimation in the background.">RDC_disablePhaseGainEstimation()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gab0d652afa4b993ded0d8cd16d6aeaeb0" title="Enables Phase Auto Correction.">RDC_enablePhaseAutoCorrection()</a></code>,<code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga5c039c2f9613275827c43c12d610e986" title="Disables Phase Auto Correction.">RDC_disablePhaseAutoCorrection()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga98daa2bc1a72aee669363a74eb841aad" title="Enable Gain Auto correction.">RDC_enableGainAutoCorrection()</a></code>,<code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga74349a1af156271c27faa6f977a261ea" title="Disable Gain Auto Correction.">RDC_disableGainAutoCorrection()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga1ffabf2ea6c9f474763444caf5a0e32d" title="Sets the Manual Gain Correction values for Sin and Cos.">RDC_setGainBypassValue()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga53c0bb7956b0ba40ee8769463d7bd6d5" title="sets the Cos Phase Manual Bypass Value">RDC_setCosPhaseBypass()</a></code></li>
</ol>
</li>
<li>Track2 Loop is a type 2 tracking loop for the Angle and also outputs Velocity (theta diff at the sampling rate) configure the Kvelfilt value for the velocity filter coefficient, in the stucture <a class="el" href="structTrack2Constants__t.html" title="struct to hold the track2 constant data">Track2Constants_t</a> and use <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gaa12103bf80f212a788aa07fbe24fe624" title="sets up the Track2 loop constants the following are the constants that can be setup using this API">RDC_setTrack2Constants()</a></code> for configuring the track2 constants.</li>
<li>Finally, configure the interrupts using the following APIs<ol type="a">
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga6463cea42677b8909ef46e128bf44090" title="Enable Sequencer Error Interrupt.">RDC_enableSequencerInterrupt()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#gac1e8381f631a17847855ae6e964078cf" title="Disable Sequencer Error Interrupt.">RDC_disableSequencerInterrupt()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga6aac8356647b6b5764bb6a3b16b26211" title="Clear the Sequencer Error Interrupt status.">RDC_clearSequencerInterrupt()</a></code></li>
<li><code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga02377f4cbf52d285c037ee234be374e5" title="enable Core Interrupt">RDC_enableCoreInterrupt()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga326286dba3635614d1321e8064362a81" title="Disable Core Interrupt.">RDC_disableCoreInterrupt()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga76f3deebb68c7db9eb4d2383d9edada7" title="returns enabled Interrupt Sources">RDC_getCoreEnabledInterruptSources()</a></code>, <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga79635a129c8c0bf42c9d33b163ab4846" title="Clear the Core Interrupt status.">RDC_clearCoreInterrupt()</a></code></li>
</ol>
</li>
<li>the interrupts may be read by the status APIs <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga19358c433acb37d051a1c9e3369bb938" title="Returns Sequencer interrupt Status.">RDC_getSequencerInterruptStatus()</a></code> and <code><a class="el" href="group__DRV__RESOLVER__MODULE.html#ga5adbf8cabcf50379ec9439e94bc5b999" title="Returns Core interrupt Status.">RDC_getCoreInterruptStatus()</a></code></li>
</ol>
<h1><a class="anchor" id="autotoc_md1032"></a>
Tuning Parameters</h1>
<p>Ideal Sample, Phase/Gain correction values are identified to be the Tuning Parameters. For each there are sample(glitch) threshold and train limit achieved flags. for tuning, the software has to configure these, enable the resolver and wait for the train limit done flags. post that, the Phase Gain estimation values may be read (note for the PG estimation to run, the motor has to be in spinning.) and can be used for Manual correction values. The Ideal Sample Mode-Auto will will fill the Peak-Histogram-Buckets until the train limit done. software needs to read these buckets and identify the one with more number, use it as the ideal sample override value with the ideal sample mode set to Manual </p>
<h1><a class="anchor" id="autotoc_md1033"></a>
Example Usage</h1>
<p>Include the below file to access the APIs </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="resolver_8h.html">drivers/resolver.h</a>&gt;</span></div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md1034"></a>
API</h1>
<p><a class="el" href="group__DRV__RESOLVER__MODULE.html">APIs for RESOLVER</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aresolver_8h_html"><div class="ttname"><a href="resolver_8h.html">resolver.h</a></div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
