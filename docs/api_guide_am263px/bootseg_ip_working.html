<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263Px MCU+ SDK: How to A/B Swap? Working of bootseg IP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263Px MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263Px MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('bootseg_ip_working.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How to A/B Swap? Working of bootseg IP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md616">Introduction</a></li>
<li class="level1"><a href="#autotoc_md617">How to make 1st Half as Active Region</a></li>
<li class="level1"><a href="#autotoc_md618">How to make 2nd Half as Active Region</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_developer_guides_bootseg_ip_working_bootseg_ip_working"></a></p>
<h1><a class="anchor" id="autotoc_md616"></a>
Introduction</h1>
<p>One of the key component of Firmware Updated-Over-Air (FOTA) is to switch to a new verison of firmware. BootSeg hardware IP has been added in the SOC to alows this switching to the other image. Bootseg IP is part of FSAS area of SOC. The following image shows the location of bootseg hardware block as part of FSAS.</p>
<p> <style>div.image img[src="bootsegIP.png"]{width:50%}</style> </p><div class="image">
<img src="bootsegIP.png" alt=""/>
<div class="caption">
Bootseg Hardware block. The part that is highlighted in red is the BootSeg IP.</div></div>
<p>In the above image, all CPU transactions are coming on VBUSM interface and going to <code>64M to 128M</code> protocol converter hardware block. After that it goes to BootSeg hardware block which does the address translation.</p>
<p>On the same data path there is <code>OTFA+ECCM</code> hardware block which is safety and security block (see <a class="el" href="OPTIFLASH.html">OptiFlash Memory Technology</a>). Then there is FOTA IP at the bottom. At the end, right side of the above image, is the flash controller (OSPI0).</p>
<dl class="section note"><dt>Note</dt><dd>The SDK driver of this IP is at "source/drivers/fss/v0".</dd></dl>
<p>The main idea is, at a time, the flash is divided into 2 region. Suppose that flash is 32MB then 1st region is from 0 to 16MB and then 2nd region is from 16MB to 32MB. A valid image can be in any of the region and it is required to boot either from region 1st or region 2nd without application being aware from which region it is being boot from. To achieve this, all address are required to be translated to the correct region.</p>
<p>The following image shows the same:  <style>div.image img[src="abswap_mech_1.png"]{width:40%}</style> </p><div class="image">
<img src="abswap_mech_1.png" alt=""/>
<div class="caption">
Bootseg IP working</div></div>
<ol type="1">
<li>Initially, starting of the flash is considered as Boot Region A (or the active region) and the applcaition that is present (FW V1) in this region is then booted.</li>
<li>During the runtime of FW V1, a new firmware is recieved (FW V2) which is stored in Region B.</li>
<li>On next reset, previously the region which was "Region B", is now being set to "Region A" and new firmware (FW V2) is now booted.</li>
</ol>
<p>It is easier to talk in terms of absolute numbers. That is, there are 2 regions in the flash from which application can boot viz. 0-16MB and 16MB - 32MB (for a flash of 32MB in size) and at boot time, it is required to set one region as Active region and other one as backup region or Region A and Region B. Bootseg IP, is then used to make either</p><ol type="1">
<li>0MB -16MB as Active reigon from which to boot and 16MB - 32MB as backup region.</li>
<li>16MB - 32MB as Active reigon from which to boot and 0MB - 16MB as backup region.</li>
</ol>
<p>Please note that here, we are assuming that size of flash is 32MB and each region size is half of size of flash here.</p>
<h1><a class="anchor" id="autotoc_md617"></a>
How to make 1st Half as Active Region</h1>
<p>In the fss driver <code>source\drivers\fss\v0\<a class="el" href="fss_8h.html">fss.h</a></code> there is an API called <code>FSS_selectRegionA</code> which will select 1st half of flash as the boot region or Active region and applicaton need to make sure to write in region B of the flash.</p>
<h1><a class="anchor" id="autotoc_md618"></a>
How to make 2nd Half as Active Region</h1>
<p>In the fss driver <code>source\drivers\fss\v0\<a class="el" href="fss_8h.html">fss.h</a></code> there is an API called <code>FSS_selectRegionB</code> which will select 2nd half of flash as the boot region or Active region and applicaton need to make sure to write in region B of the flash. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
