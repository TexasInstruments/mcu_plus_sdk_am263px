<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263Px MCU+ SDK: OSPI Low Level Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263Px MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263Px MCU+ SDK
   &#160;<span id="projectnumber">11.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('DRIVERS_OSPI_LLD_PAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">OSPI Low Level Driver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1104">Features Supported</a></li>
<li class="level1"><a href="#autotoc_md1105">SysConfig Features</a></li>
<li class="level1"><a href="#autotoc_md1106">OSPI Phy Tuning Algorithm</a></li>
<li class="level1"><a href="#OSPI_LLD_MIGRATION_GUIDE">OSPI LLD Migration Guide</a><ul><li class="level2"><a href="#autotoc_md1107">11.02.00 Changes</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1108">Features not Supported</a></li>
<li class="level1"><a href="#autotoc_md1109">Example Usage</a></li>
<li class="level1"><a href="#autotoc_md1110">API</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_drivers_ospi_lld"></a></p>
<p>The Octal Serial Peripheral Interface (OSPI) module is a kind of Serial Peripheral Interface (SPI) module which allows single, dual, quad or octal read and write access to external flash devices. The OSPI module is used to transfer data, either in a memory mapped direct mode (for example a processor wishing to execute code directly from external flash memory), or in an indirect mode where the module is set-up to silently perform some requested operation, signaling its completion via interrupts or status registers.</p>
<h1><a class="anchor" id="autotoc_md1104"></a>
Features Supported</h1>
<ul>
<li>Support for single, dual, quad (QSPI mode) or octal I/O instructions.</li>
<li>Supports dual Quad-SPI mode for fast boot applications.</li>
<li>Memory mapped ‘direct’ mode of operation for performing flash data transfers and executing code from flash memory.</li>
<li>Programmable delays between transactions.</li>
<li>Legacy mode allowing software direct access to low level transmit and receive FIFOs, bypassing the higher layer processes.</li>
<li>An independent reference clock to decouple bus clock from SPI clock – allows slow system clocks.</li>
<li>Programmable baud rate generator to generate OSPI clocks.</li>
<li>Supports BOOT mode.</li>
<li>Handling ECC errors for flash devices with embedded correction engine.</li>
<li>Support DMA Read.</li>
<li>Interrupt mode is supported.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1105"></a>
SysConfig Features</h1>
<dl class="section note"><dt>Note</dt><dd>It is strongly recommend to use SysConfig where it is available instead of using direct SW API calls. This will help simplify the SW application and also catch common mistakes early in the development cycle.</dd></dl>
<ul>
<li>OSPI instance name</li>
<li>Input clock frequency to be used for OSPI module</li>
<li>Input clock divider which decides the baud-rate at which the flash will be read</li>
<li>Chip Select</li>
<li>Enabling of various features like DMA and PHY mode.<ul>
<li>PHY configuration allows to<ul>
<li>Configuring window tuning parameters.</li>
<li>Set PHY control mode (master/bypass)</li>
<li>Determine if master delay line locks in half/full cycle of delay.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p> <style>div.image img[src="ospi_phy_configuration.png"]{ width:80%}</style> </p><div class="image">
<img src="ospi_phy_configuration.png" alt=""/>
<div class="caption">
OSPI PHY Configurations Syscfg</div></div>
<ul>
<li>Tuning window parameters,contains various parameters for OSPI tuning<ul>
<li>Min and Max values for read delays.</li>
<li>TxDLL low start and end, defines txDLL window for finding rxLow.</li>
<li>TxDLL high start and end, defines txDLL winodw for finding backup rxLow.</li>
<li>RxDLL low search start, minimum value for rxLow.</li>
<li>RxDLL low search end, maximum value for rxLow.</li>
<li>RxDLL high search start, minimum value for rxHigh.</li>
<li>RxDLL high search end, maximum value for rxHigh.</li>
<li>TxDLL low search start, minimum value for txLow.</li>
<li>TxDLL low search end, maximum value for txLow.</li>
<li>TxDLL high search start, minimum value for txHigh.</li>
<li>TxDLL high search end, maximum value for txHigh.</li>
<li>TxDLL search offset, increment in txDLL value while searching rxLow/rxHigh values.</li>
<li>RxDL &amp; TxDLL Search Step, step size for finding rx and tx low/high values.</li>
</ul>
</li>
</ul>
<div class="image">
<img src="ospi_window_params.png" alt=""/>
<div class="caption">
OSPI WINDOW PARAMS</div></div>
<ul>
<li>In advanced config, you can choose various parameters like frame format, decoder chip select, read dummy cycles etc.</li>
<li>Pinmux configurations for the OSPI instance</li>
</ul>
<h1><a class="anchor" id="autotoc_md1106"></a>
OSPI Phy Tuning Algorithm</h1>
<p>The OSPI tuning algorithm works as follows:</p><ul>
<li><b>Step 1 Find Golden Primary RxLow</b><br  />
 To find the RxDLL boundaries, we fix a valid TxDLL and search through RxDLL range, rdDelay values.<br  />
 As we are not sure of a valid TxDLL we use a window of TxDLL values to find the RxDLL boundaries. <pre class="fragment">            Rx_DLL
              ▲
              │   ++++++++++++++++
          127 │     ++++++++++++++
              │   x   ++++++++++++
              │   xx   +++++++++++
              │   xxx   ++++++++++
              │   xxxx   +++++++++
              │   xxxxx   ++++++++
              │ │ xxx│xx   +++++++
              │ │ xxx│xxx   ++++++
              │ │ xxx│xxxx   +++++
              │ │ xxx│xxxxx   ++++
              │ │ xxx│xxxxxx   +++
     Search   │ │ xxx│xxxxxxx   ++
     Rx_Low ──┼─┤►xxx│xxxxxxxx   +
              │ │    │
             ─┼─┼────┼------────►  Tx_DLL
             0│ │    │           127
                │    │
                │    │

            Tx_Low   Tx_Low
            Start    End
</pre> <br  />
</li>
<li><b>Step 2 Find Golden Secondary RxLow</b><br  />
 Search for one more rxLow at different txDl, To find Secondary rxHigh we use the txDLL + Search_offset value of rxLow.<br  />
<br  />
</li>
<li><b>Step 3 Select minimum of primary rxLow and secondary rxLow Value</b><br  />
<ul>
<li>Pick minimum value of rxDLL between rxLow and sec_rxLow.</li>
<li>Pick Minimum value of rdDelay(read_delay) between rxLow and sec_rxLow.<br  />
 <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Primary<br  />
 Search  </th><th class="markdownTableHeadCenter">Secondary<br  />
 Search  </th><th class="markdownTableHeadLeft">Final Point   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyLeft">Return Fail   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyLeft">Return Fail   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyLeft">Return Fail   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyLeft">RxDll = Min(Primary, Secondary) <br  />
 RdDelay = Min(Primary, Secondary) <br  />
 TxDll = Primary   </td></tr>
</table>
<br  />
</li>
</ul>
</li>
<li><b>Step 4 Find Golden Primary Rx High</b><br  />
 To find rxHigh we use the txDLL values of rxLow.<br  />
 Start the rdDelay (Read delay) from maximum and decrement it.<br  />
 As these are valid values and rxHigh rdDelay is always &gt;= rxLow rdDelay. <pre class="fragment">            Rx_DLL
              ▲
          127 │   ▲+++++++++++++++
    Search    │   │ ++++++++++++++
   Rx_High────┼──►│   ++++++++++++
   on Fixed   │   │x   +++++++++++
    Tx_DLL    │   │xx   ++++++++++
              │   │xxx   +++++++++
              │   │xxxx   ++++++++
              │   ▼xxxxx   +++++++
              │   Xxxxxxx   ++++++
              │   Xxxxxxxx   +++++
              │   Xxxxxxxxx   ++++
              │   Xxxxxxxxxx   +++
              │   Xxxxxxxxxxx   ++
              │   Xxxxxxxxxxxx   +
              │
             ─┼------------───►  Tx_DLL
             0│                  127
</pre> <br  />
</li>
<li><b>Step 5 Find Golden Secondary Rx High</b><br  />
 To find Secondary rxHigh we use the txDLL + Search_offset value of rxLow.<br  />
 Start the rdDelay (Read delay) from maximum and decrement it.<br  />
 As these are valid values and rxHigh rdDelay is always &gt;= rxLow rdDelay.<br  />
<br  />
</li>
<li><b>Step 6 Select maximum of primary and secondary rxHigh value</b><br  />
<ul>
<li>Compare the Primary and Secondary point.<br  />
</li>
<li>Pick the point which has passing maximum rxDll.<br  />
 <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Primary<br  />
 Search  </th><th class="markdownTableHeadCenter">Secondary<br  />
 Search  </th><th class="markdownTableHeadLeft">Final Point   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyLeft">Return Fail   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyLeft">Return Fail   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyLeft">Return Fail   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyLeft">If(secondary.rxDll &gt; primary.rxDll) <br  />
 Pick Secondary search point <br  />
 Else <br  />
 Pick Primary search point   </td></tr>
</table>
<br  />
</li>
</ul>
</li>
<li><b>Step 7 Do a backup Search in case rxLow and rx High has same read delay values</b><br  />
 Check a different point if the rxLow and rxHigh are on the same rdDelay.<br  />
 This avoids mistaking the metastability gap for an rxDLL boundary.<br  />
<ul>
<li><b>Find backup rx Low</b> Find the rxDLL boundaries using the TxDLL window at the higher end .<br  />
 We start the window_end and decrement the TxDLL value until we find the valid point. <pre class="fragment">       Rx_DLL
        ▲
        │   ++++++++++++++++
    127 │   ++++++++++++++++
        │   ++++++++++++++++
        │    +++++++++++++++
        │     +++++++++│++++│
        │      ++++++++│++++│
        │   x   +++++++│++++│
        │   xx   ++++++│++++│
        │   xxx   +++++│++++│
        │   xxxx   ++++│++++│
        │   xxxxx   +++│++++│
        │   xxxxxx   ++│++++│
        │   xxxxxxx   +│++++│         Search
        │   xxxxxxxx   │++++◄───────  Rx_Low
        │              │    │
       ─┼──────────────┼────┤► Tx_DLL
       0│              │    │   127
                       │    │
               Tx_High        Tx_High
               Start          End
</pre></li>
<li><b>Find backup sec rxLow</b><br  />
 Search for one more rxLow at different txDll, we use the txDLL - Search_offset value of rxLow.<br  />
</li>
<li><b>Select minimum of backup rxLow and backup sec rxLow</b><ul>
<li>Pick minimum value of rxDLL between rxLow and sec_rxLow.</li>
<li>Pick Minimum value of rdDelay(read_delay) between rxLow and sec_rxLow.<br  />
</li>
</ul>
</li>
<li><b>Find backup primary rxHigh search</b> Find rxDLL Max<br  />
 Start the rdDelay (Read delay) from maximum and decrement it.<br  />
<pre class="fragment">        Rx_DLL
127 ▲
    │   +++++++++++++++▲                Search Rx_High
    │   +++++++++++++++│◄────────────   on Fixed Tx_DLL
    │   +++++++++++++++│
    │    ++++++++++++++│
    │     +++++++++++++│
    │      ++++++++++++│
    │   x   +++++++++++▼
    │   xx   +++++++++++
    │   xxx   ++++++++++
    │   xxxx   +++++++++
    │   xxxxx   ++++++++
    │   xxxxxx   +++++++
    │   xxxxxxx   ++++++
    │   xxxxxxxx    ++++
    │
   ─┼────────────────────► Tx_DLL
   0│                       127
</pre></li>
<li><b>Find backup secondary rxHigh search</b><br  />
 Search for one more rxHigh at different txDll, we use the txDLL - Search_offset value of rxLow.<br  />
</li>
<li><b>Select maximum of backup primary and secondary rxhigh</b><br  />
 Compare the Primary and Secondary point.<br  />
 Pick the point which has passing maximum rxDll.<br  />
 <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Primary<br  />
 Search  </th><th class="markdownTableHeadCenter">Secondary<br  />
 Search  </th><th class="markdownTableHeadLeft">Final Point   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyLeft">Return Fail   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyLeft">Return Fail   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyCenter">Fail  </td><td class="markdownTableBodyLeft">Return Fail   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyCenter">Pass  </td><td class="markdownTableBodyLeft">If(secondary.rxDll &gt; primary.rxDll) <br  />
 Pick Secondary search point <br  />
 Else <br  />
 Pick Primary search point   </td></tr>
</table>
<br  />
</li>
</ul>
</li>
<li><b>Step 8 Find golden TxLow</b> Look for txDLL boundaries at 1/4 of rxDLL window.<br  />
 Find txDLL Min.<br  />
<pre class="fragment">                      Rx_DLL
                 127 ▲
                     │   ++++++++++++++++
          Rx_High    │     ++++++++++++++
              ───────┼──►x   ++++++++++++
                     │   xx   +++++++++++
                     │   xxx   ++++++++++
                     │   xxxx   +++++++++
       Fix Rx_DLL    │   xxxxx   ++++++++
      1/4 between    │   xxxxxx   +++++++
      Rx_High and    │   xxxxxxx   ++++++
        Rx_Low       │   xxxxxxxx   +++++
               ──────┼─► ◄───┬──►    ++++
                     │   xxxx│xxxxx   +++
           Rx_Low    │   xxxx│xxxxxx   ++
               ──────┼──►xxxx│xxxxxxx   +
                     │       │
                    ─┼───────┼───────────►  Tx_DLL
                    0│       │          127
                             │
                        Search Tx_Low
</pre> <br  />
</li>
<li><b>Step 9 Find golden TxHigh</b><br  />
 Find txDLL Max.<br  />
 Start the rdDelay (Read delay) from maximum and decrement it.<br  />
<pre class="fragment">        Rx_DLL
           127 ▲
               │   +++++++++++++++++
    Rx_High    │     +++++++++++++++
        ───────┼──►x   +++++++++++++
               │   xx   ++++++++++++
               │   xxx   +++++++++++
               │   xxxx   ++++++++++
 Fix Rx_DLL    │   xxxxx   +++++++++
1/4 between    │   xxxxxx   ++++++++
Rx_High and    │   xxxxxxx   +++++++
   Rx_Low      │   xxxxxxxx   ++++++
         ──────┼─► xxxxxxxxx   ◄─┬─►
               │   xxxxxxxxxx   +│++
     Rx_Low    │   xxxxxxxxxxx   │++
         ──────┼──►xxxxxxxxxxxx  │++
               │                 │
              ─┼─────────────────┼─►  Tx_DLL
              0│                 │127
                              Search Tx_Max
</pre> <br  />
</li>
<li><b>Step 10 Do a backup Search in case rxLow and rx High has same read delay values</b><br  />
 Check a different point if the txLow and txHigh are on the same rdDelay.<br  />
 This avoids mistaking the metastability gap for a txDLL boundary.<br  />
<ul>
<li><b>Find a backup primary txLow</b><br  />
 Look for txDLL boundaries at 3/4 of rxDLL window.<br  />
 Find txDLL Min.<br  />
<pre class="fragment">         Rx_DLL
        127 ▲
            │
   Rx_High──┼──►+++++++++++++++++
Fix Rx_DLL  │   +++++++++++++++++
   3/4 of   │   +++++++++++++++++
  Rx_High  ─┼─► ◄───┬───►++++++++
and Rx_Low  │     ++│++++++++++++
            │      +│++++++++++++
            │   x   │++++++++++++
            │   xx  │++++++++++++
            │   xxx │ +++++++++++
            │   xxxx│  ++++++++++
            │   xxxx│   +++++++++
            │   xxxx│x   ++++++++
            │   xxxx│xx   +++++++
    Rx_Low──┼──►xxxx│xxx   ++++++
            │       │
           ─┼───────┼────────────► Tx_DLL
           0│       │               127
               Search Tx_Min
</pre></li>
<li><b>Find a backup primary txHigh</b><br  />
 Find txDLL Max.<br  />
 Start the rdDelay (Read delay) from maximum and decrement it.<br  />
<pre class="fragment">         Rx_DLL
          127
            ▲
            │
   Rx_High──┼──►+++++++++++++++++
            │   +++++++++++++++++
 Fix Rx_DLL │   +++++++++++++++++
 3/4 of ────┼─► +++++++◄────┬───►
  Rx_High   │     ++++++++++│++++
   and      │      +++++++++│++++
  Rx_Low    │   x   ++++++++│++++
            │   xx   +++++++│++++
            │   xxx   ++++++│++++
            │   xxxx   +++++│++++
            │   xxxxx   ++++│++++
            │   xxxxxx   +++│++++
            │   xxxxxxx   ++│++++
    Rx_Low──┼──►xxxxxxxx   +│++++
            │               │
           ─┼───────────────┼────► Tx_DLL
           0│               │       127
                         Search Tx_Max
</pre> <br  />
</li>
</ul>
</li>
<li><b>Step 11 Find bottom left and top right corners</b><br  />
 These are theoretical corners. They may not actually be "good" points.<br  />
 But the longest diagonal of the shmoo will be between these corners.<br  />
<br  />
</li>
<li><b>Step 12 Find the tuning point</b><ul>
<li><b>Step1</b> Find the equation of diagonal between topRight(rxHigh,txHigh) and bottomLeft(rxLow,txLow) points.</li>
<li><b>Step2</b> Find gapLow, last point along the slope of bottom left read delay region.</li>
<li><b>Step3</b> If top right and bottom left have same read delay, put tuning point in the middle and adjust for temperature.</li>
<li><b>Step4</b> If top right and bottom left have different read delays, find gapHigh, the starting point along the slope of top left read delay region.</li>
<li><b>Step5</b> Find len1 = gapLow - topLeft, len2 = topRight - gapHigh.</li>
<li><b>Step6</b> Choose the read Delay region with maximum length.</li>
<li><b>Step7</b> Place the Phy tuning point in the corner farthest from the gap.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="OSPI_LLD_MIGRATION_GUIDE"></a>
OSPI LLD Migration Guide</h1>
<h2><a class="anchor" id="autotoc_md1107"></a>
11.02.00 Changes</h2>
<table class="doxtable">
<tr>
<th>API </th><th>Remarks  </th></tr>
<tr>
<td><a class="el" href="group__DRV__OSPI__LLD__PHY__API__MODULE.html#gafd227d515282233156c11c820eecf274">OSPI_lld_phyTuneGrapher</a> </td><td>Param arrays[4][128][128] updated to arrays[5][128][128]  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1108"></a>
Features not Supported</h1>
<h1><a class="anchor" id="autotoc_md1109"></a>
Example Usage</h1>
<p>Include the below file to access the APIs </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ospi_8h.html">drivers/ospi.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ospi__lld_8h.html">drivers/ospi/v0/lld/ospi_lld.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kernel/dpl/MutexArmP.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="DebugP_8h.html">kernel/dpl/DebugP.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;kernel/nortos/dpl/r5/HwiP_armv7r_vim.h&gt;</span></div>
</div><!-- fragment --><p> Instance Open Example </p><div class="fragment"><div class="line">    int32_t status = <a class="code" href="ospi__lld_8h.html#a55d0de1852596151ea5221adf3930c55">OSPI_SYSTEM_SUCCESS</a>;</div>
<div class="line">    gOspiHandle = &amp;gOspiObject[CONFIG_OSPI0];</div>
<div class="line"> </div>
<div class="line">    status = <a class="code" href="ospi__lld_8h.html#ac930a2647f66d87a7efaed91b05eb22b">OSPI_lld_init</a>(gOspiHandle);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(status == <a class="code" href="ospi__lld_8h.html#a55d0de1852596151ea5221adf3930c55">OSPI_SYSTEM_SUCCESS</a>);</div>
</div><!-- fragment --><p> Non-Blocking Example ISR Register </p><div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="group__lld__ethernet.html#ga8c1dfc1ccf00a08192611433ee7f17b4">__attribute__</a>((__section__(<span class="stringliteral">&quot;.text.hwi&quot;</span>), noinline, naked, target(<span class="stringliteral">&quot;arm&quot;</span>), aligned(4))) void App_OSPI_ISR(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    ISR_CALL_LEVEL_NONFLOAT_REENTRANT(<a class="code" href="group__DRV__OSPI__LLD__CALLBACK__API__MODULE.html#ga03b7d6c2985ac9fd8c45197b5223aa3e">OSPI_lld_isr</a>, \</div>
<div class="line">                                      gOspiHandle, \</div>
<div class="line">                                      intrNum, \</div>
<div class="line">                                      gOSPIVimStsAddr, \</div>
<div class="line">                                      gOSPIVimStsClrMask,</div>
<div class="line">                                      intcBaseAddr);</div>
<div class="line">}</div>
</div><!-- fragment --><p> Non-Blocking Transfer Example </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> transfer_nonblocking(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="structOSPI__Transaction.html">OSPI_Transaction</a> transaction;</div>
<div class="line">    uint32_t status = <a class="code" href="group__KERNEL__DPL__SYSTEM.html#ga47e638d7c694e6d42e57b96b071b8a6f">SystemP_SUCCESS</a>;</div>
<div class="line"> </div>
<div class="line">    gOspiHandle-&gt;interruptCallback = isrCallback;</div>
<div class="line">    intrNum = gOspiHandle-&gt;hOspiInit-&gt;intrNum;</div>
<div class="line">    intcBaseAddr = gHwiConfig.intcBaseAddr;</div>
<div class="line">    gOSPIVimStsAddr = intcBaseAddr + (0x404u + (((intrNum)&gt;&gt; 5) &amp; 0xFu) * 0x20u);</div>
<div class="line">    gOSPIVimStsClrMask = 0x1u &lt;&lt; ((intrNum) &amp; 0x1Fu);</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Register Interrupt */</span></div>
<div class="line">    HwiP_setPri(intrNum, 4U);</div>
<div class="line">    HwiP_setVecAddr(intrNum, (uintptr_t)&amp;App_OSPI_ISR);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__HWI.html#gaccf47c6fb95111f0fbba1b86705d5907">HwiP_enableInt</a>(intrNum);</div>
<div class="line">    HwiP_setAsPulse(intrNum, FALSE);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__DRV__OSPI__LLD__TRANS__INIT__API__MODULE.html#ga0fe11a08bf60be67834bef6e01e849bf">OSPI_lld_Transaction_init</a>(&amp;transaction);</div>
<div class="line">    transaction.addrOffset = APP_OSPI_FLASH_OFFSET;</div>
<div class="line">    transaction.buf = (<span class="keywordtype">void</span> *)(gOspiTxBuf);</div>
<div class="line">    transaction.count = APP_OSPI_DATA_SIZE;</div>
<div class="line">    <a class="code" href="group__DRV__OSPI__LLD__READ__WRITE__MODULE.html#gafccf7cee32027d511f06e5910e94780c">OSPI_lld_writeIndirect</a>(gOspiHandle, &amp;transaction);</div>
<div class="line">    <span class="keywordflow">if</span> (status == <a class="code" href="group__KERNEL__DPL__SYSTEM.html#ga47e638d7c694e6d42e57b96b071b8a6f">SystemP_SUCCESS</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">while</span>(try_lock_mutex(&amp;transferMutex) == MUTEX_ARM_LOCKED);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a>(<span class="stringliteral">&quot;OSPI Write Fail&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* Mutex Lock */</span></div>
<div class="line">    transferMutex = MUTEX_ARM_LOCKED;</div>
<div class="line">    transaction.buf = (<span class="keywordtype">void</span> *)(gOspiRxBuf);</div>
<div class="line">    status = <a class="code" href="group__DRV__OSPI__LLD__READ__WRITE__MODULE.html#ga44904dad5400f05b8aa05b370d8cff73">OSPI_lld_readIndirect</a>(gOspiHandle, &amp;transaction);</div>
<div class="line">    <span class="keywordflow">if</span> (status == <a class="code" href="group__KERNEL__DPL__SYSTEM.html#ga47e638d7c694e6d42e57b96b071b8a6f">SystemP_SUCCESS</a> )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">while</span>(try_lock_mutex(&amp;transferMutex) == MUTEX_ARM_LOCKED);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a>(<span class="stringliteral">&quot;OSPI Read Fail&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* De-Register Interrupt */</span></div>
<div class="line">    HwiP_setVecAddr(intrNum, 0);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__HWI.html#ga2038ae2b7b264bf3ad8b68a9a117ad20">HwiP_disableInt</a>(intrNum);</div>
<div class="line">}</div>
</div><!-- fragment --><p> Instance Close Example </p><div class="fragment"><div class="line">    int32_t status = <a class="code" href="ospi__lld_8h.html#a55d0de1852596151ea5221adf3930c55">OSPI_SYSTEM_SUCCESS</a>;</div>
<div class="line"> </div>
<div class="line">    status = <a class="code" href="ospi__lld_8h.html#a1e216aee614427d4b927084c0ee55e5f">OSPI_lld_deInit</a>(gOspiHandle);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(status == <a class="code" href="ospi__lld_8h.html#a55d0de1852596151ea5221adf3930c55">OSPI_SYSTEM_SUCCESS</a>);</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md1110"></a>
API</h1>
<p><a class="el" href="group__DRV__OSPI__LLD__MODULE.html">APIs for OSPI LLD</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aospi__lld_8h_html"><div class="ttname"><a href="ospi__lld_8h.html">ospi_lld.h</a></div><div class="ttdoc">OSPI LLD Driver API/interface file.</div></div>
<div class="ttc" id="agroup__DRV__OSPI__LLD__CALLBACK__API__MODULE_html_ga03b7d6c2985ac9fd8c45197b5223aa3e"><div class="ttname"><a href="group__DRV__OSPI__LLD__CALLBACK__API__MODULE.html#ga03b7d6c2985ac9fd8c45197b5223aa3e">OSPI_lld_isr</a></div><div class="ttdeci">void OSPI_lld_isr(void *args)</div><div class="ttdoc">QSPI ISR for Read and Write Functionality.</div></div>
<div class="ttc" id="astructOSPI__Transaction_html"><div class="ttname"><a href="structOSPI__Transaction.html">OSPI_Transaction</a></div><div class="ttdoc">Data structure used with OSPI_Transfers - OSPI_lld_readDirect, OSPI_lld_writeDirect,...</div><div class="ttdef"><b>Definition:</b> ospi_lld.h:436</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__HWI_html_ga2038ae2b7b264bf3ad8b68a9a117ad20"><div class="ttname"><a href="group__KERNEL__DPL__HWI.html#ga2038ae2b7b264bf3ad8b68a9a117ad20">HwiP_disableInt</a></div><div class="ttdeci">uint32_t HwiP_disableInt(uint32_t intNum)</div><div class="ttdoc">Disable a specific interrupt.</div></div>
<div class="ttc" id="agroup__DRV__OSPI__LLD__TRANS__INIT__API__MODULE_html_ga0fe11a08bf60be67834bef6e01e849bf"><div class="ttname"><a href="group__DRV__OSPI__LLD__TRANS__INIT__API__MODULE.html#ga0fe11a08bf60be67834bef6e01e849bf">OSPI_lld_Transaction_init</a></div><div class="ttdeci">void OSPI_lld_Transaction_init(OSPI_Transaction *trans)</div><div class="ttdoc">Function to initialize the OSPI_Transaction structure.</div></div>
<div class="ttc" id="aospi__lld_8h_html_ac930a2647f66d87a7efaed91b05eb22b"><div class="ttname"><a href="ospi__lld_8h.html#ac930a2647f66d87a7efaed91b05eb22b">OSPI_lld_init</a></div><div class="ttdeci">int32_t OSPI_lld_init(OSPILLD_Handle hOspi)</div><div class="ttdoc">This function opens a given OSPI peripheral.</div></div>
<div class="ttc" id="agroup__DRV__OSPI__LLD__READ__WRITE__MODULE_html_gafccf7cee32027d511f06e5910e94780c"><div class="ttname"><a href="group__DRV__OSPI__LLD__READ__WRITE__MODULE.html#gafccf7cee32027d511f06e5910e94780c">OSPI_lld_writeIndirect</a></div><div class="ttdeci">int32_t OSPI_lld_writeIndirect(OSPILLD_Handle handle, OSPI_Transaction *trans)</div><div class="ttdoc">Function to perform indirect writes to the flash using INDAC controller.</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__DEBUG_html_gafe348ab5badd2c15118f95e21bb192c6"><div class="ttname"><a href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a></div><div class="ttdeci">#define DebugP_log(format,...)</div><div class="ttdoc">Function to log a string to the enabled console.</div><div class="ttdef"><b>Definition:</b> DebugP.h:225</div></div>
<div class="ttc" id="agroup__DRV__OSPI__LLD__READ__WRITE__MODULE_html_ga44904dad5400f05b8aa05b370d8cff73"><div class="ttname"><a href="group__DRV__OSPI__LLD__READ__WRITE__MODULE.html#ga44904dad5400f05b8aa05b370d8cff73">OSPI_lld_readIndirect</a></div><div class="ttdeci">int32_t OSPI_lld_readIndirect(OSPILLD_Handle handle, OSPI_Transaction *trans)</div><div class="ttdoc">Function to perform indirect reads from the flash using INDAC controller.</div></div>
<div class="ttc" id="agroup__lld__ethernet_html_ga8c1dfc1ccf00a08192611433ee7f17b4"><div class="ttname"><a href="group__lld__ethernet.html#ga8c1dfc1ccf00a08192611433ee7f17b4">__attribute__</a></div><div class="ttdeci">struct lld_sockaddr __attribute__</div><div class="ttdoc">This is the SecureBoot Stream type which holds the data for a specific bootloader to HSM call....</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__HWI_html_gaccf47c6fb95111f0fbba1b86705d5907"><div class="ttname"><a href="group__KERNEL__DPL__HWI.html#gaccf47c6fb95111f0fbba1b86705d5907">HwiP_enableInt</a></div><div class="ttdeci">void HwiP_enableInt(uint32_t intNum)</div><div class="ttdoc">Enable a specific interrupt.</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__SYSTEM_html_ga47e638d7c694e6d42e57b96b071b8a6f"><div class="ttname"><a href="group__KERNEL__DPL__SYSTEM.html#ga47e638d7c694e6d42e57b96b071b8a6f">SystemP_SUCCESS</a></div><div class="ttdeci">#define SystemP_SUCCESS</div><div class="ttdoc">Return status when the API execution was successful.</div><div class="ttdef"><b>Definition:</b> SystemP.h:56</div></div>
<div class="ttc" id="aospi__lld_8h_html_a55d0de1852596151ea5221adf3930c55"><div class="ttname"><a href="ospi__lld_8h.html#a55d0de1852596151ea5221adf3930c55">OSPI_SYSTEM_SUCCESS</a></div><div class="ttdeci">#define OSPI_SYSTEM_SUCCESS</div><div class="ttdoc">Return status when the API execution was successful.</div><div class="ttdef"><b>Definition:</b> ospi_lld.h:272</div></div>
<div class="ttc" id="aospi__lld_8h_html_a1e216aee614427d4b927084c0ee55e5f"><div class="ttname"><a href="ospi__lld_8h.html#a1e216aee614427d4b927084c0ee55e5f">OSPI_lld_deInit</a></div><div class="ttdeci">int32_t OSPI_lld_deInit(OSPILLD_Handle hOspi)</div><div class="ttdoc">Function to close a OSPI peripheral specified by the OSPI handle.</div></div>
<div class="ttc" id="aDebugP_8h_html"><div class="ttname"><a href="DebugP_8h.html">DebugP.h</a></div></div>
<div class="ttc" id="aospi_8h_html"><div class="ttname"><a href="ospi_8h.html">ospi.h</a></div></div>
<div class="ttc" id="agroup__KERNEL__DPL__DEBUG_html_ga552e9055ca7eab5fe6c224c6cd5a9d4c"><div class="ttname"><a href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a></div><div class="ttdeci">#define DebugP_assert(expression)</div><div class="ttdoc">Function to call for assert check.</div><div class="ttdef"><b>Definition:</b> DebugP.h:177</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
