<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263Px MCU+ SDK: Resolver Angle and Velocity resolution example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263Px MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263Px MCU+ SDK
   &#160;<span id="projectnumber">11.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_RESOLVER_ANGLE_SPEED.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Resolver Angle and Velocity resolution example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md2747">Introduction</a><ul><li class="level2"><a href="#autotoc_md2748">Resolver to Digital Converter in AM26x Family</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2749">Example Description</a><ul><ul><li class="level3"><a href="#autotoc_md2750">Input Configurations</a></li>
<li class="level3"><a href="#autotoc_md2751">Excitation Configurations</a></li>
<li class="level3"><a href="#autotoc_md2752">Tuning Parameters</a></li>
<li class="level3"><a href="#autotoc_md2753">Resolver Core Configurations</a></li>
<li class="level3"><a href="#autotoc_md2754">Interrupt Configurations and ISR details</a></li>
</ul>
<li class="level2"><a href="#autotoc_md2755">SW Track2 details</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2756">External Connections</a><ul><li class="level2"><a href="#autotoc_md2757">AM263PX-CC</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2758">Watch variables:</a></li>
<li class="level1"><a href="#EXAMPLES_DRIVERS_RESOLVER_ANGLE_SPEED_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md2759">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md2760">See Also</a></li>
<li class="level1"><a href="#autotoc_md2761">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_resolver_angle_speed"></a></p>
<h1><a class="anchor" id="autotoc_md2747"></a>
Introduction</h1>
<p>A Resolver to Digital Converter (RDC) resolves the angle and velocity of a motor from the physical resolver connected to it. this is done so by sending out an excitation sine wave of higher frequency, 20KHz in case of this example, and modulating it across the sine and cosine windings of the resolver, based on the motor shaft position.</p>
<p> <style>div.image img[src="am263p_resovler_modulator_diagram.png"]{width:100%}</style> </p><div class="image">
<img src="am263p_resovler_modulator_diagram.png" alt=""/>
<div class="caption">
External Resolver Modulation based on the shaft position</div></div>
<h2><a class="anchor" id="autotoc_md2748"></a>
Resolver to Digital Converter in AM26x Family</h2>
<p>RDC in AM26x family, reads the Sine and Cosine inputs via its ADC_R0, ADC_R1 in various configurable parameters. these are then fed to the Hardware loops for various signal error corrections viz., DC offset correction / Band Pass filter, Phase Correction, Gain Correction. the DC offset, Phase-Gain corrections can be configured for Auto mode as the IP supports estimation for the same.</p>
<p> <style>div.image img[src="am263p_resolver_ip_block_diagram.png"]{width:100%}</style> </p><div class="image">
<img src="am263p_resolver_ip_block_diagram.png" alt=""/>
<div class="caption">
Resolver to Digital Converter Block Diagram</div></div>
<h1><a class="anchor" id="autotoc_md2749"></a>
Example Description</h1>
<p>This example configures the RDC in Single Ended mode, and to take inputs parallely on sine and cosine modulated waveforms from one motor. The Results of the resolver are read in an ISR triggered at every 5 uS, or at 20KHz frequency, equal to that of the Excitation Sine Signal.</p>
<h3><a class="anchor" id="autotoc_md2750"></a>
Input Configurations</h3>
<p>The <em>Sequencer mode 0</em> is selected. The sine signal is sample by ADC_R0 on channel AIN0, while the cosine is sampled by ADC_R1 on Channel AIN0. Both signals are sampled simultaneously by the ADC_Rs. ADC burst count is disabled, with ADC SoC width is set for 0, i.e., minimum offered from the IP, of 100nS-120nS. </p><dl class="section note"><dt>Note</dt><dd>The sequencer mode selection automatically takes care of the ADC_R configurations, which the user/ application need not configure any further.</dd></dl>
<h3><a class="anchor" id="autotoc_md2751"></a>
Excitation Configurations</h3>
<p>The <em>Excitation frequency</em> is set at <em>20KHz</em>, with sync in enabled. The <em>PWM XBar 2</em>, which is connected to resolver to digital converter in case of AM263Px, is configured for the EPWM0 syncout signal. The ADC SoC start Delay is set at 20, i.e., 20*1250nS +30nS or, 25.030 uS. </p>
<h3><a class="anchor" id="autotoc_md2752"></a>
Tuning Parameters</h3>
<p>Manual Tuning parameters set as following.</p><ol type="1">
<li>Phase offset correction value : 0</li>
<li>Sin Gain Correction Value : 25000</li>
<li>Cos Gain Correction Value : 25000</li>
<li>Ideal Sample Override Value : 7</li>
</ol>
<h3><a class="anchor" id="autotoc_md2753"></a>
Resolver Core Configurations</h3>
<ul>
<li>DC offset Correction enabled, for calcoef1,2 being 8,9 and Manual correction offset correction values being 0.</li>
<li>Ideal Sample Mode is set to 3 (Manual), with detection threshold of 2500 and bottom sampling disabled.</li>
<li>Phase Gain Estimation is disabled, and Gain Correction with Manual values of 25000 on both sin and cos, is enabled.</li>
<li>track2 kvelfilt is set to 8. <dl class="section note"><dt>Note</dt><dd>In Sequencer Mode 0, the Resolver Core 0 takes in the values form the ADC_R0, ADC_R1 on the sin and cos samples and computes for the angle and the velocity. the Resovler Core 1 is not used in this scenario, and hence need not configure the parameters for the Resolver Core 1.</dd></dl>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md2754"></a>
Interrupt Configurations and ISR details</h3>
<ul>
<li>EPWM1 is set to generate interrupt from its Event Trigger Submodule when the counter hits compare A value of 20 while incrementing. the interrupt is generated at every period, i.e., the interrupt generation frequency is 20KHz.</li>
<li>EPMM1 INT is configured at INTxBar0, which further is used for ISR App_epwm1ISR for reading the HW results from RDC and computing SW track2 loop (optional for more accurate results).</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>No Interrupt from the RDC (Resolver to Digital Converter) is enabled. Although interrupts may be used for ESM, refer integration details from TRM, the example does not configure them.</dd></dl>
<h2><a class="anchor" id="autotoc_md2755"></a>
SW Track2 details</h2>
<ul>
<li>The example showcases an additional method for computing the angle and velocity which may be optionally used. For quicker accesses, the loop needs to be placed at TCM and should be strictly timed to the excitation signal frequency.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2756"></a>
External Connections</h1>
<h2><a class="anchor" id="autotoc_md2757"></a>
AM263PX-CC</h2>
<p>Connect the Single ended inputs from the external resolver to the following.</p><ul>
<li>Sine Modulated signal : ADC_R0_AIN0 or HSEC pin</li>
<li>Cosine Modulated signal : ADC_R1_AIN0 or HSEC pin Connect the Excitation Frequency generated from RES0_PWMOUT0 or HSEC pin</li>
</ul>
<p>This example on AM263Px ZCZ-S pacakge with HSEC connecter, has been validated using the resolver LTN-R58 and the Wolfspeed Traction Inverter reference design (<a href="https://www.ti.com/tool/TIDM-02014">https://www.ti.com/tool/TIDM-02014</a>)</p>
<dl class="section note"><dt>Note</dt><dd>for the AM263Px CC E1 board, the resolver excitation, ADC_Rx_AINy pins are muxed and are controlled from the IO Expander on board. </dd></dl>
<h1><a class="anchor" id="autotoc_md2758"></a>
Watch variables:</h1>
<ul>
<li>raw_atan_angle : Holds the results of Angle, in degrees, from Arc Tan loop of the RDC.</li>
<li>raw_track2_angle : Holds the results of Angle, in degrees, from the raw Track2 Loop of RDC.</li>
<li>sw_track2_angle : Holds the results of Angle, in degrees, from the SW track2 loop.</li>
<li>raw_track2_velocity : Holds the results of Velocity, in RPS, from the raw Track2 Loop of RDC.</li>
<li>sw_track2_velocity : Holds the results of Velocity, in RPS, from the SW Track2 Loop</li>
</ul>
<h1><a class="anchor" id="EXAMPLES_DRIVERS_RESOLVER_ANGLE_SPEED_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am263px-cc, am263px-lp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/resolver/resolver_angle_speed/   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md2759"></a>
Steps to Run the Example</h1>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>Establish connections as mentioned in External Connections section.</li>
<li>Launch a CCS debug session and run the executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>Using the watch variables, view the ADC conversion results.</li>
<li>View the ADC conversion results in UART console logs</li>
</ul>
<h1><a class="anchor" id="autotoc_md2760"></a>
See Also</h1>
<p><a class="el" href="DRIVERS_RESOLVER_PAGE.html">RESOLVER</a></p>
<h1><a class="anchor" id="autotoc_md2761"></a>
Sample Output</h1>
<p>the following is a sample CCS Console output for the example run.,</p>
<div class="fragment"><div class="line">[Cortex_R5_0] Detected CC version is E2. Calling TCA6424 Drivers for io expander configurations</div>
<div class="line">Setting RESOLVER ADC Mux Select Lines, Index : 14, State : 1</div>
<div class="line">Setting RESOLVER ADC Mux Select Lines, Index : 15, State : 0</div>
<div class="line">Setting RESOLVER ADC Mux Select Lines, Index : 5, State : 0</div>
<div class="line">Setting RESOLVER ADC Mux Select Lines, Index : 6, State : 1</div>
<div class="line">Setting RESOLVER ADC Mux Select Lines, Index : 8, State : 1</div>
<div class="line">Setting RESOLVER ADC Mux Select Lines, Index : 2, State : 1</div>
<div class="line">setting up the EPWM ISR!!</div>
<div class="line">setting up the EPWM ISR Complete!!</div>
<div class="line">Resolver Enabled!!</div>
<div class="line">Forcing the Sync Pulse from the EPMW0!!</div>
<div class="line">4000 Iterations complete. Printing some of the values</div>
<div class="line">        ANGLES (DEGREES)                    ||  VELOCITIES (RPS)</div>
<div class="line">----------------------------------------------------------------||-----------------------------------------------</div>
<div class="line">    ATAN        RAW_TRACK2  SW_TRAKC2       ||  HW_TRACK2       SW_TRACK2</div>
<div class="line">    193.304443  193.441772  0.000196        ||  193.359375  193.386841</div>
<div class="line">    193.348389  193.359375  193.375854      ||  -0.000494   -0.000494</div>
<div class="line">    193.304443  193.364868  193.381348      ||  -0.000494   -0.000494</div>
<div class="line">    193.414307  193.364868  193.381348      ||  0.001355    0.001355</div>
<div class="line">    193.331909  193.364868  193.381348      ||  0.000773    0.000773</div>
<div class="line">    193.359375  193.359375  193.375854      ||  -0.000754   -0.000754</div>
<div class="line">    193.348389  193.359375  193.375854      ||  -0.000470   -0.000470</div>
<div class="line">    193.331909  193.375854  193.392334      ||  0.001644    0.001644</div>
<div class="line">    193.293457  193.364868  193.381348      ||  -0.000391   -0.000391</div>
<div class="line">    193.265991  193.359375  193.375854      ||  -0.003041   -0.003041</div>
<div class="line">All tests have passed!!</div>
</div><!-- fragment --><p>Once the Angle and Velocity results from the watchpoints are plotted, results may be similar to the following, where legends atan, raw angle. Sample output for a constant velocity may be as follows.</p>
<p> <style>div.image img[src="am263p_resolver_sample_output.png"]{width:50%}</style> </p><div class="image">
<img src="am263p_resolver_sample_output.png" alt=""/>
<div class="caption">
Resolver Angle Speed Resolution Sample Output</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
