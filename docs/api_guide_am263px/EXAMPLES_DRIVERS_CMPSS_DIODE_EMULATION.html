<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM263Px MCU+ SDK: CMPSS Diode Emulation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM263Px MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM263Px MCU+ SDK
   &#160;<span id="projectnumber">11.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_CMPSS_DIODE_EMULATION.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CMPSS Diode Emulation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md2268">Introduction</a></li>
<li class="level1"><a href="#autotoc_md2269">EPWM Configuration</a></li>
<li class="level1"><a href="#autotoc_md2270">DAC Configuration</a></li>
<li class="level1"><a href="#autotoc_md2271">CMPSS Configuration</a></li>
<li class="level1"><a href="#autotoc_md2272">Various DE configuration</a><ul><li class="level2"><a href="#autotoc_md2273">EPWM in CBC mode</a></li>
<li class="level2"><a href="#autotoc_md2274">EPWM in CBC mode with Re-entry delay</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2275">External Connections</a><ul><li class="level2"><a href="#autotoc_md2276">AM263PX-CC</a></li>
<li class="level2"><a href="#autotoc_md2277">AM261X-SOM</a></li>
<li class="level2"><a href="#autotoc_md2278">AM263PX-LP</a></li>
<li class="level2"><a href="#autotoc_md2279">AM261X-LP REV A</a></li>
</ul>
</li>
<li class="level1"><a href="#EXAMPLES_DRIVERS_CMPSS_DIODE_EMULATION_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md2280">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md2281">See Also</a></li>
<li class="level1"><a href="#autotoc_md2282">Sample Output</a></li>
<li class="level1"><a href="#autotoc_md2283">References</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_cmpss_diode_emulation"></a></p>
<h1><a class="anchor" id="autotoc_md2268"></a>
Introduction</h1>
<p>This example showcases the Diode Emulation features using CMPSS where the trip inputs are sourced from CMPSS. At CMPSS, there are 2 shadow values for the CMPSS DACs (high and low comparator's), namely "Shadow" and "Shadow 2". when the DE mode is enabled, and DEACTIVE signal high, the "shadow 2" value is used for updating the active register (see image below).</p>
<h1><a class="anchor" id="autotoc_md2269"></a>
EPWM Configuration</h1>
<p>EPWM0, EPWM1 and EPWM2 are configured to generate a 25KHz signal with 50% duty cycle.</p>
<h1><a class="anchor" id="autotoc_md2270"></a>
DAC Configuration</h1>
<p>DAC0 is used as positive input to CMPSSA1 High and Low: (CMPSSA0 in case of LP).</p>
<p>Reference voltage source = external.</p>
<h1><a class="anchor" id="autotoc_md2271"></a>
CMPSS Configuration</h1>
<p>CMPSSA1 (CMPSSA0 in case of LP) configuration for TRIPH/TRIPL signal inputs to enter DE mode:</p><ul>
<li>Positive input = DAC_OUT for both CMPSSA1 High and Low. A ramp wave is generated in the example for showcasing.</li>
<li>Negative input = 1.65v from internal DAC for CMPSSA1 High (CMPSSA0 in case of LP). <pre class="fragment">             3.3v from internal DAC for CMPSSA1 Low (CMPSSA0 in case of LP).
</pre></li>
</ul>
<p>This means only CMPSSTRIPH1 is triggered when DAC_OUT &gt; 1.65v and CMPSSTRIPL1 is always low</p>
<p>Diode Emulation Configuration:</p><ul>
<li>For EPWM0 and EPWM1, TripH = CMPSSTRIPH1 and TRIPL = CMPSSTRIPL1. Since a TRIPH_OR_TRIPL triggers DE entry, only TripH is used for demo.</li>
<li>EPWM0_A is set to active high and EPWM0_B set to low during DE</li>
<li>EPWM1_A is configured same as EPWM0 with re-entry delay<ul>
<li>Re-entry delay = 10 EPWMSYNCPER cycles</li>
</ul>
</li>
<li>EPWMSYNCPER is configured at Counter equals TB Period for both the epwms.</li>
<li>EPWM2 is confiugred same as EPWM0 with DE mode disabled for the purpose of comparison</li>
</ul>
<p> <style>div.image img[src="am263px_basic_diode_emulation_config.png"]{width:50%}</style> </p><div class="image">
<img src="am263px_basic_diode_emulation_config.png" alt=""/>
<div class="caption">
Basic diode emulation configuration with trip inputs from CMPSS</div></div>
<p>OutputXbar 13 and 14 is used to route the CTRIPOUTH and CTRIPOUTL signal. OutputXbar 7 and 8 (5 and 6 in case of AM261x-SOM) is used to route DEActive0 from EPWM0 and DEActive1 from EPWM1.</p>
<h1><a class="anchor" id="autotoc_md2272"></a>
Various DE configuration</h1>
<h2><a class="anchor" id="autotoc_md2273"></a>
EPWM in CBC mode</h2>
<p>EPWM0 is configured in CBC mode where on occurrence of every PWMSYNC it evaluates if TRIPH_OR_TRIPL condition is present and if not then DEACTIVE flag is cleared.</p>
<p>Channel A:</p>
<p> <style>div.image img[src="am263px_cmpss_diode_emulation.png"]{width:50%}</style> </p><div class="image">
<img src="am263px_cmpss_diode_emulation.png" alt=""/>
<div class="caption">
EPWM in CBC mode with DEACTIVE for channel A</div></div>
<p>Initially when TRIPH_OR_TRIPL was 0 as marked by the blue marker, EPWM0A was following the normal action configured in the AQ. We can compare with EPWM2A. Once TRIPH_OR_TRIPL gets High as marked by the red marker, it enters into the DEACTIVE mode and now EPWM0A is driven by TRIPH as per the configuration.On occurrence of the PWMSYNC, since TripHorTripL goes low, DEACTIVE flag will get cleared and EPWM0A starts following the normal AQ actions (take EPWM2A as reference)</p>
<h2><a class="anchor" id="autotoc_md2274"></a>
EPWM in CBC mode with Re-entry delay</h2>
<p>EPWM1 is configured in CBC mode but with Re-entry delay = 10. This means once EPWM1 exits the DEACTIVE mode, for next 10 PWMSYNCs it won’t enter into DEACTIVE mode even if TRIPH_OR_TRIPL is High. EPWM1A are also shown for comparison.</p>
<p> <style>div.image img[src="am263px_cmpss_diode_emulation_reentry.png"]{width:50%}</style> </p><div class="image">
<img src="am263px_cmpss_diode_emulation_reentry.png" alt=""/>
<div class="caption">
EPWM in CBC mode with Re-entry = 10 for channel A</div></div>
<p>The green marker marks the exit of DEACTIVE because that’s the point where PWMSYNC comes and TRIPH_OR_TRIPL is low. At this point, the Re-entry counter will get loaded with the Re-entry value i.e. 10 in our case. It will decrement by one on every PWMSYNC. The trip signals are blocked as long as counter value is greater than 0. The counter reaches 0 on occurrence of PWMSYNC. If we see carefully, the EPWM1A now is driven by TripH from this point.</p>
<h1><a class="anchor" id="autotoc_md2275"></a>
External Connections</h1>
<ul>
<li>Connect DAC output to CMPIN1P and CMPIN1N for AM263Px CC (CMPIN0P and CMPIN0N in case of AM263PX LP)</li>
<li>Probe EPWM2A for reference waveform</li>
<li>Probe EPWM0A and 1A for the diode emulation waveforms on non-reentry delay and re-entry delay DE EPWMs respectively</li>
</ul>
<h2><a class="anchor" id="autotoc_md2276"></a>
AM263PX-CC</h2>
<p>When using AM263Px-CC with TMDSHSECDOCK (HSEC180 controlCARD Baseboard Docking Station)</p><ul>
<li>Connect HSEC Pin 9 (DAC_OUT) to HSEC Pin 15 and 17 (CMPSSA1H/L)</li>
<li>Probe the following on the HSEC Pin<ul>
<li>EPWM0A : 49</li>
<li>EPWM1A : 53</li>
<li>EPWM2A : 50</li>
<li>DEActive0 : 87</li>
<li>DEActive1 : 85</li>
<li>CTRIPH : 68</li>
<li>CTRIPL : 70</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md2277"></a>
AM261X-SOM</h2>
<p>When using AM261x-SOM with TMDSHSECDOCK (HSEC180 controlCARD Baseboard Docking Station)</p><ul>
<li>Connect HSEC Pin 9 (DAC_OUT) to HSEC Pin 15 and 17 (CMPSSA1H/L)</li>
<li>Probe the following on the HSEC Pin<ul>
<li>EPWM0A : 49</li>
<li>EPWM1A : 53</li>
<li>EPWM2A : 50</li>
<li>DEActive0 : 76</li>
<li>DEActive1 : 78</li>
<li>CTRIPH : 68</li>
<li>CTRIPL : 70</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md2278"></a>
AM263PX-LP</h2>
<ul>
<li>Connect J1/J3 Pin 30 (DAC_OUT) to J1/J3 Pin 23 and J1/J3 28 (CMPSSA0H/L)</li>
<li>Probe the following on boosterpack<ul>
<li>EPWM0A : J2/4 Pin 11</li>
<li>EPWM1A : J2/4 Pin 37</li>
<li>EPWM2A : J2/4 Pin 39</li>
<li>DEActive0 : J5/7 Pin 49</li>
<li>DEActive1 : J5/7 Pin 50</li>
<li>CTRIPH : J6/8 Pin 72</li>
<li>CTRIPL : J6/8 Pin 71</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md2279"></a>
AM261X-LP REV A</h2>
<ul>
<li>Connect J1/J3 Pin 30 (DAC_OUT) to J1/J3 Pin 26 and J1/J3 2 (CMPSSA0H/L)</li>
<li>Probe the following on boosterpack<ul>
<li>EPWM3A : J5/7 Pin 38</li>
<li>EPWM2A : J2/4 Pin 40</li>
<li>DEActive0 : J5/7 Pin 49</li>
<li>DEActive1 : J5/7 Pin 50</li>
<li>CTRIPL : J5/7 Pin 43 (needs IO Expander config)</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="EXAMPLES_DRIVERS_CMPSS_DIODE_EMULATION_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boards  </td><td class="markdownTableBodyNone">am263px-cc, am263px-lp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/cmpss/cmpss_diode_emulation/   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md2280"></a>
Steps to Run the Example</h1>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>Establish connections as mentioned in External Connections section</li>
<li>Launch a CCS debug session and run the executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>When a low input is provided, Trip signal output is low and EPWM gives a PWM waveform</li>
<li>When a high input(higher than VDD/2) is provided, Trip signal output turns high and EPWM gets tripped</li>
</ul>
<h1><a class="anchor" id="autotoc_md2281"></a>
See Also</h1>
<p><a class="el" href="DRIVERS_CMPSS_PAGE.html">CMPSS</a></p>
<h1><a class="anchor" id="autotoc_md2282"></a>
Sample Output</h1>
<p>Shown below is a sample output when the application is run,</p>
<div class="fragment"><div class="line">CMPSS Diode Emulation Logic Test Started ...</div>
<div class="line">CMPSS Diode Emulation Logic Test Passed!!</div>
<div class="line">All tests have passed!!</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2283"></a>
References</h1>
<p> <style>div.image img[src="am263_epwm_de_reference_1.PNG"]{width:60%}</style> </p><div class="image">
<img src="am263_epwm_de_reference_1.PNG" alt=""/>
<div class="caption">
Figure 6a. Diode Emulation Logic</div></div>
<p><br  />
 <br  />
  <style>div.image img[src="am263_epwm_de_reference_2.PNG"]{width:60%}</style> </p><div class="image">
<img src="am263_epwm_de_reference_2.PNG" alt=""/>
<div class="caption">
Figure 6b. DE Active flag functionality</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
